#!/bin/sh
# the next line restarts using wish \
exec wish8.0 "$0" "$@"
#
# ClassyTcl
# --------- Peter De Rijk
#

wm withdraw .
tk appname cbuild
package require ClassyTcl

if {"$argv" != ""} {
	set file [lindex $argv 0]
	set argv [lrange $argv 1 end]
	if {"[file pathtype $file]" == "relative"} {
		set file [file join [pwd] $file]
	}
} else {
	set file ""
	set file [Classy::savefile -title "Build Application" -help cbuild]
	if {"$file" == ""} exit
}

set name [file root [file tail $file]]
if ![file exists $file] {
	if {[lsearch {conf help lib} $name] != -1} {
		error "Cannot create application named \"$name\": reserved"
	}
	if ![Classy::yorn "Create application	\"$name\""] {exit}
	file copy [file join $class::dir template] $file
	file rename [file join $file template.tcl] [file join $file $name.tcl]
	set file [file join $file $name.tcl]
} elseif [file isdir $file] {
	set file [file join $file $name.tcl]
}
set f [open $file]
gets $f;gets $f;gets $f
set line [gets $f]
set v 0.1
regexp {[0-9.]+$} $line v
close $f
switch $v {
	0.1 {
		exec [file join $::class::dir bin convert0.1_to_0.2] $file
	}
}
puts "Starting application \"$name\""
if {"$tcl_platform(platform)" != "windows"} {
	eval exec {$file} -builder $argv &
} else {
	set dir [file dir [file dir [info library]]]
	eval exec [list [file join $dir bin wish80.exe]] {$file} -builder $argv &
}
exit

